---
sshd_banner_enable: 'false'
sshd_config:
  PermitRootLogin: 'yes'
  UseDNS: 'no'
ntp_config_server : ['0.freebsd.pool.ntp.org' , '1.freebsd.pool.ntp.org', '2.freebsd.pool.ntp.org']
ntp_mode: 'server'
resolv_nameservers:
  - 172.31.2.129
  - 172.31.2.130
resolv_domain: home
pf_role_enable: True
pf_ftpproxy_enable: True
pf_file_content: |
  # ansible managed - do not edit this file from here !
  set skip on lo

  set state-defaults pflow

  block return    # block stateless traffic
  pass            # establish keep-state

  # By default, do not permit remote connections to X11
  block return in on ! lo0 proto tcp to port 6000:6010
pf_ip_forward_enable: True

dhcpd_authoritative: true
dhcpd_keys:
  - key: "ddns-key"
    algorithm: "hmac-md5"
    secret: "{{ vault_ddns_key_secret }}"
dhcpd_zones:
  - zone: "home.dhcp."
    primary: "127.0.0.1"
    key: "ddns-key"
  - zone: "dhcp.1.31.172.in-addr.arpa."
    primary: "127.0.0.1"
    key: "ddns-key"
dhcpd_options: |
    ddns-updates on;
    ddns-update-style interim;
dhcpd_shared_networks:
  - name: "shared-net"
    subnets: '{{ dhcpd_subnets_local }}' 
    options: |
      default-lease-time 600;
      max-lease-time 900;
      option domain-name "home";
      option domain-name-servers 172.31.2.131;
      filename "lpxelinux.0";
dhcpd_subnets_local:
  - subnet: "172.31.1.0"
    netmask: '255.255.255.0'
    router: '172.31.1.254'
    options: |
      ddns-domainname "home.dhcp.";
      ddns-rev-domainname "dhcp.1.31.172.in-addr.arpa.";
      ignore client-updates;
    pools:
      - comment: 'first range'
        range: '172.31.1.64 172.31.1.96'
      - comment: 'second range'
        range: '172.31.1.210 172.31.1.240'

zone_home:
  ns:
    - { rdata: "fw-gw.home." }
#  mx:
#    - { priority: 10,  rdata: "fw-gw.home." }
  records:
    - { name: "fw-gw" , type: A , rdata: "172.31.2.131" }
    - { name: "jwebgw2", type: A , rdata: "172.31.1.48" }
zone_172_31_2_rev:
  records:
    - { name: "131", type: "PTR" , rdata: "fw-gw.home." }
zone_172_30_0_rev:
  records: []
zone_172_30_1_rev:
  records: []
zone_172_31_1_static_rev:
  records:
    - { name: "48", type: "PTR" , rdata: "jwebgw2.home." }
zone_172_31_1_rev: 
  records:
    - { name: "$GENERATE 1-63 $" ,type: CNAME , rdata: "$.static.1.31.172.in-addr.arpa." }
    - { name: "$GENERATE 64-96 $" ,type: CNAME , rdata: "$.1.31.172.dhcp.1.31.172.in-addr.arpa." }
    - { name: "$GENERATE 97-209 $" ,type: CNAME , rdata: "$.static.1.31.172.in-addr.arpa." }
    - { name: "$GENERATE 210-240 $" ,type: CNAME, rdata: "$.1.31.172.dhcp.1.31.172.in-addr.arpa." }
    - { name: "$GENERATE 241-254 $" ,type: CNAME , rdata: "$.static.1.31.172.in-addr.arpa." }
zone_rzp_static_dhcp: "{{ vault_zone_rzp_static_dhcp }}"
bind_zone_loopback_v6_enable: False
bind_dns_fqdn_name: "{{ ansible_host }}"
bind_hostmaster_name: hostmaster.home
bind_acls: 
  - name: goodclients
    addr_list: ['172.16.0.0/16' ,'127.0.0.1','10.0.0.0/8','192.168.0.0/16']
bind_options_allow_recursion: ['goodclients']
bind_options_allow_query: ['goodclients']
bind_options_additionals:
  - 'response-policy { zone "rzp-static-dhcp"; }'
bind_logging_channels:
  - name: default
    out: syslog daemon
    severity: info
  - name: update_log
    severity: "info"
    file: 
      name: "logs/update.log"
      version: 5
      size: "3M"
    print_time: yes
    print_category: yes
    print_severity: yes
  - name: test_log
    file:
      name: "logs/test.log"
bind_logging_categories:
  - name: default
    channels: [ 'default']
  - name: update
    channels: [ 'update_log' ]
bind_keys:
  - key:  "ddns-key"
    algorithm: 'hmac-md5'
    secret: "{{ vault_ddns_key_secret }}"
  - key:  "foreman-key"
    algorithm: 'hmac-md5'
    secret: "{{ vault_foreman_key_secret }}"
bind_zones:
  - name: 'home.dhcp'
    type: master
    dynamic: true
    managed: false
    parameters:
      - 'allow-update { key "ddns-key"; }'
  - name: 'vmlab.lan'
    type: forward
    forwarders: ['172.30.0.11','172.30.0.12']
  - name: 'home'
    type: master
    managed: true
    content: "{{ zone_home }}"
  - name: "1.99.10.in-addr.arpa"
    type: forward
    forwarders: ['172.30.0.11','172.30.0.12']
  - name: "2.99.10.in-addr.arpa"
    type: forward
    forwarders: ['172.30.0.11','172.30.0.12']
  - name: "0.30.172.in-addr.arpa"
    type: master
    managed: true
    content: "{{ zone_172_30_0_rev }}"
  - name: "1.30.172.in-addr.arpa"
    type: master
    managed: true
    content: "{{ zone_172_30_1_rev }}"
  - name: "2.31.172.in-addr.arpa"
    type: master
    managed: true
    content: "{{ zone_172_31_2_rev }}"
  - name: "1.31.172.in-addr.arpa"
    type: master
    managed: true
    content: "{{ zone_172_31_1_rev }}"
  - name: "static.1.31.172.in-addr.arpa"
    type: master
    managed: true
    content: "{{ zone_172_31_1_static_rev }}"
  - name: "dhcp.1.31.172.in-addr.arpa"
    type: master
    managed: false
    dynamic: true
    parameters:
      - 'allow-update { key "ddns-key"; }'
  - name: "rzp-static-dhcp"
    type: master
    managed: true
    dynamic: false
    content: "{{ zone_rzp_static_dhcp }}"
    parameters:
      - 'allow-query { none; }'
